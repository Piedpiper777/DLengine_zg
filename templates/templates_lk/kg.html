{% extends "templates_lk/base.html" %}

{% block styles %}
{{ super() }} 
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles_kg_search.css') }}"/>
<style>
    /* çŸ¥è¯†å›¾è°±ä¿¡æ¯æ ·å¼ */
    .kg-info {
        margin-bottom: 20px;
    }
    
    .kg-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 10px;
    }
    
    .kg-stat-item {
        background: #f8f9fa;
        border-radius: 4px;
        padding: 10px 15px;
        flex-grow: 1;
        min-width: 120px;
        text-align: center;
    }
    
    .kg-stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #007bff;
    }
    
    .kg-stat-label {
        font-size: 12px;
        color: #6c757d;
    }
    
    .kg-created-time {
        margin-top: 10px;
        font-size: 14px;
        color: #6c757d;
        text-align: right;
    }
    
    /* çŸ¥è¯†å›¾è°±åˆ—è¡¨æ ·å¼ */
    .kg-list {
        margin-bottom: 20px;
    }
    
    .kg-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }
    
    .kg-item:last-child {
        border-bottom: none;
    }
    
    .kg-name {
        font-weight: bold;
    }
    
    .kg-actions {
        display: flex;
        gap: 10px;
    }
    
    .kg-view-btn, .kg-delete-btn, .kg-edit-btn {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .kg-view-btn {
        background: #007bff;
        color: white;
    }
    
    .kg-view-btn:hover {
        background: #0069d9;
    }

    .kg-edit-btn {
        background: #28a745;
        color: white;
    }
    
    .kg-edit-btn:hover {
        background: #218838;
    }
    
    .kg-delete-btn {
        background: #dc3545;
        color: white;
    }
    
    .kg-delete-btn:hover {
        background: #c82333;
    }
    
    /* çŸ¥è¯†å›¾è°±å¯è§†åŒ–æ ·å¼ */
    .kg-visualization {
        height: 500px;
        border: 1px solid #ddd;
        border-radius: 4px;
        overflow: hidden;
        position: relative;
        margin-bottom: 20px;
    }
    
    #neo4j-graph {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
    }
    
    .kg-loading {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255,255,255,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 10px;
        z-index: 10;
    }
    
    .kg-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #007bff;
        border-radius: 50%;
        animation: kg-spin 2s linear infinite;
    }
    
    @keyframes kg-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* æ§åˆ¶æŒ‰é’®æ ·å¼ */
    .kg-controls {
        position: absolute;
        bottom: 15px;
        right: 15px;
        display: flex;
        gap: 8px;
        z-index: 8;
        background: rgba(255, 255, 255, 0.8);
        padding: 6px;
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    
    .kg-controls button {
        width: 34px;
        height: 34px;
        border: none;
        background: #f0f0f0;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
    }
    
    .kg-controls button:hover {
        background: #e0e0e0;
    }
    
    .kg-controls button.active {
        background: #3a86ff;
        color: white;
    }
    
    /* æŸ¥è¯¢è¡¨å•æ ·å¼ - æ–‡æœ¬æ¡†å‘æŒ‰é’®å¯¹é½ç‰ˆæœ¬ */
    .kg-query-section {
        margin-bottom: 20px;
    }

    .query-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    /* æ–‡æœ¬æ¡†å®¹å™¨ - ç›¸å¯¹å®šä½ */
    .query-input-wrapper {
        position: relative;
        width: 100%;
        display: flex;
    }

    /* æ–‡æœ¬æ¡†æ ·å¼ - å³è¾¹æ¡†ç§»é™¤ï¼Œä¸ºæŒ‰é’®è®©ä½ */
    .query-form textarea {
        padding: 10px 15px 10px 15px; /* ç§»é™¤å³ä¾§ç‰¹æ®Šå†…è¾¹è· */
        border: 1px solid #ddd;
        border-right: none; /* ç§»é™¤å³è¾¹æ¡†ï¼Œè®©æŒ‰é’®æä¾›å³è¾¹æ¡† */
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
        border-top-right-radius: 0;    /* ç§»é™¤å³ä¾§åœ†è§’ */
        border-bottom-right-radius: 0; /* ç§»é™¤å³ä¾§åœ†è§’ */
        resize: vertical;
        min-height: 100px;
        width: 100%;
        box-sizing: border-box;
        outline: none;
        flex: 1;
    }

    /* å½“æ–‡æœ¬æ¡†è·å¾—ç„¦ç‚¹æ—¶çš„æ ·å¼ */
    .query-form textarea:focus {
        border-color: #007bff;
        box-shadow: none;
    }

    /* æŸ¥è¯¢æŒ‰é’® - ä½œä¸ºæ–‡æœ¬æ¡†çš„å³ä¾§éƒ¨åˆ† */
    .query-button-inline {
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 90px;
        border: 1px solid #007bff; /* æŒ‰é’®æä¾›å®Œæ•´è¾¹æ¡† */
        border-left: 1px solid #007bff; /* ä¸æ–‡æœ¬æ¡†è¿æ¥ */
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        border-top-right-radius: 4px;    /* æŒ‰é’®æä¾›å³ä¾§åœ†è§’ */
        border-bottom-right-radius: 4px;
        background: #007bff;
        color: white;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
    }

    .query-button-inline:hover {
        background: #0056b3;
        border-color: #0056b3;
    }

    .query-button-inline:disabled {
        background: #6c757d;
        border-color: #6c757d;
        cursor: not-allowed;
    }

    /* å½“æ–‡æœ¬æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼ŒæŒ‰é’®è¾¹æ¡†ä¹Ÿè¦å˜è‰² */
    .query-form textarea:focus + .query-button-inline {
        border-color: #007bff;
    }

    /* æ¸…é™¤æŒ‰é’®æ ·å¼ */
    .query-clear-button {
        align-self: flex-start;
        margin-top: 8px;
        min-width: 80px;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
        .query-button-inline {
            width: 80px;
            font-size: 13px;
        }
    }
    
    /* æ–‡ä»¶ä¸Šä¼ æ ·å¼ */
    .upload-area {
        border: 2px dashed #ddd;
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        margin-bottom: 20px;
        background-color: #f8f9fa;
        transition: all 0.3s ease;
    }

    .upload-area:hover {
        border-color: #007bff;
        background-color: #f0f7ff;
    }

    .upload-icon {
        font-size: 48px;
        color: #6c757d;
        margin-bottom: 15px;
    }

    .upload-text {
        margin-bottom: 15px;
        color: #495057;
    }

    .file-input {
        display: none;
    }

    .file-label {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        display: inline-block;
        transition: background-color 0.3s ease;
    }

    .file-label:hover {
        background-color: #0069d9;
    }

    .upload-progress {
        margin-top: 15px;
        display: none;
    }

    .upload-file-list {
        margin-top: 20px;
        text-align: left;
    }

    .upload-file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 8px;
    }

    .file-name {
        font-weight: 500;
        color: #495057;
    }

    .file-size {
        color: #6c757d;
        font-size: 0.875rem;
    }

    .file-status {
        font-size: 0.75rem;
        padding: 2px 8px;
        border-radius: 10px;
    }

    .status-uploading {
        background-color: #cce5ff;
        color: #004085;
    }

    .status-success {
        background-color: #d4edda;
        color: #155724;
    }

    .status-error {
        background-color: #f8d7da;
        color: #721c24;
    }

    /* å›¾è°±ç¼–è¾‘æ¨¡å¼æ ·å¼ */
    .edit-mode-controls {
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 9;
        background: rgba(255,255,255,0.9);
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .edit-mode-toggle {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .edit-mode-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .edit-mode-btn {
        display: flex;
        align-items: center;
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 0.875rem;
    }

    .edit-mode-btn:hover {
        background: #e2e6ea;
    }

    .edit-mode-btn.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }

    .edit-mode-icon {
        margin-right: 5px;
        font-size: 14px;
    }

    /* èŠ‚ç‚¹/å…³ç³»ç¼–è¾‘è¡¨å• */
    .entity-form {
        margin-top: 15px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        display: none;
    }

    .entity-form.show {
        display: block;
    }

    .entity-form-title {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 10px;
        color: #495057;
    }

    .entity-form-group {
        margin-bottom: 12px;
    }

    .entity-form-label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.875rem;
        color: #495057;
    }

    .entity-form-input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.875rem;
    }

    .entity-form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-top: 15px;
    }

    /* æ·»åŠ å¤„ç†çŠ¶æ€æ ·å¼ */
    .processing-steps {
        margin: 15px 0;
    }
    
    .processing-step {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 4px;
    }
    
    .step-icon {
        width: 30px;
        text-align: center;
        margin-right: 10px;
        color: #6c757d;
    }
    
    .step-text {
        flex: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    /* æ‹–æ‹½ä¸Šä¼ æ ·å¼ */
    .upload-area.highlight {
        border-color: #007bff;
        background-color: #e3f2fd;
    }
    
    .upload-area.drag_over {
        border-color: #28a745;
        background-color: #d4edda;
    }
    
    /* å®ä½“ç±»å‹æ ‡ç­¾æ ·å¼ */
    .entity-types {
        line-height: 2;
    }
    
    .entity-types .badge {
        margin-right: 8px;
        margin-bottom: 4px;
    }
    
    /* å›¾è°±åˆ—è¡¨åŠ è½½åŠ¨ç”» */
    .kg-list-loading {
        text-align: center;
        padding: 20px;
        color: #6c757d;
    }
    
    .kg-list-loading .spinner-border {
        width: 1.5rem;
        height: 1.5rem;
    }
</style>
{% endblock %}

{% block scripts %}
{{ super() }}

<!-- âœ… é¦–å…ˆåŠ è½½ vis.js åº“ï¼ˆNeoVis çš„ä¾èµ–ï¼‰ -->
<script src="https://unpkg.com/vis@4.21.0/dist/vis.min.js"></script>
<link href="https://unpkg.com/vis@4.21.0/dist/vis.min.css" rel="stylesheet" type="text/css" />

<!-- âœ… ç„¶ååŠ è½½ NeoVis åº“ -->
<script src="{{ url_for('static', filename='js/neovis.js') }}"></script>

<!-- âœ… å¤‡ç”¨æ£€æŸ¥å’ŒåŠ è½½ -->
<script>
    // æ£€æŸ¥NeoVisæ˜¯å¦åŠ è½½æˆåŠŸ
    window.addEventListener('load', function() {
        console.log('ğŸ” æ£€æŸ¥åº“åŠ è½½çŠ¶æ€:', {
            'vis': typeof vis !== 'undefined',
            'NeoVis': typeof NeoVis !== 'undefined'
        });
        
        if (typeof vis === 'undefined') {
            console.error("âŒ vis.jsåº“æœªåŠ è½½æˆåŠŸ");
            // å°è¯•å¤‡ç”¨CDN
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/vis@4.21.0/dist/vis.min.js';
            script.onload = function() {
                console.log('âœ… vis.js å¤‡ç”¨CDNåŠ è½½æˆåŠŸ');
                // é‡æ–°æ£€æŸ¥åº“çŠ¶æ€
                if (typeof checkLibraryConflicts === 'function') {
                    setTimeout(checkLibraryConflicts, 100);
                }
            };
            script.onerror = function() {
                console.error('âŒ vis.js å¤‡ç”¨CDNä¹ŸåŠ è½½å¤±è´¥');
            };
            document.head.appendChild(script);
            
            // åŒæ—¶åŠ è½½ CSS
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdn.jsdelivr.net/npm/vis@4.21.0/dist/vis.min.css';
            document.head.appendChild(link);
        }
        
        if (typeof NeoVis === 'undefined') {
            console.error("âŒ NeoVisåº“æœªåŠ è½½æˆåŠŸ");
            document.getElementById('neo4j-graph').innerHTML = 
                '<div style="text-align:center;padding:50px;color:#d32f2f;">å¯è§†åŒ–åº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
        } else {
            console.log("âœ… NeoVisåº“åŠ è½½æˆåŠŸ");
        }
    });
</script>

<!-- âœ… æœ€ååŠ è½½æ‚¨çš„è„šæœ¬ -->
<script src="{{ url_for('static', filename='js/kg/kg_search.js') }}"></script>
<script src="{{ url_for('static', filename='js/kg/kg_upload.js') }}"></script>
{% endblock %}

{% block content %}
<ol class="breadcrumb">
    <li class="breadcrumb-item">æ‚¨çš„ä½ç½®</li>
    <li class="breadcrumb-item active">
      <a href='{{url_for('dashboard.dashboard_application')}}'>åº”ç”¨ç¨‹åº</a>
    </li>
    <li class="breadcrumb-item active"> 
      <a href='{{url_for('dashboard.dashboard_kg')}}'>å¤§æ¨¡å‹ä¸çŸ¥è¯†å›¾è°±</a>
    </li>
    <li class="breadcrumb-item active">çŸ¥è¯†å›¾è°±</li>
</ol>
            
            <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
            <ul class="nav nav-tabs mb-4" id="kgTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="explore-tab" data-toggle="tab" href="#explore" role="tab">
                        <i class="fas fa-search mr-1"></i> å›¾è°±æ¢ç´¢
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="upload-tab" data-toggle="tab" href="#upload" role="tab">
                        <i class="fas fa-cloud-upload-alt mr-1"></i> ä¸Šä¼ åˆ›å»º
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="manage-tab" data-toggle="tab" href="#manage" role="tab">
                        <i class="fas fa-cogs mr-1"></i> å›¾è°±ç®¡ç†
                    </a>
                </li>
            </ul>
            
            <!-- æ ‡ç­¾é¡µå†…å®¹ -->
            <div class="tab-content" id="kgTabContent">
                <!-- å›¾è°±æ¢ç´¢æ ‡ç­¾é¡µ -->
                <div class="tab-pane fade show active" id="explore" role="tabpanel">
                    <!-- çŸ¥è¯†å›¾è°±ä¿¡æ¯å¡ç‰‡ -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3>çŸ¥è¯†å›¾è°±ä¿¡æ¯</h3>
                            <div class="form-group mb-0">
                                <select id="kg-selector" class="form-control">
                                    <option value="default" selected>é»˜è®¤çŸ¥è¯†å›¾è°±</option>
                                    <!-- å…¶ä»–çŸ¥è¯†å›¾è°±é€‰é¡¹å°†åŠ¨æ€åŠ è½½ -->
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="kg-info">
                                <div class="kg-stats">
                                    <div class="kg-stat-item">
                                        <div class="kg-stat-value" id="node-count">0</div>
                                        <div class="kg-stat-label">èŠ‚ç‚¹æ•°é‡</div>
                                    </div>
                                    <div class="kg-stat-item">
                                        <div class="kg-stat-value" id="relation-count">0</div>
                                        <div class="kg-stat-label">å…³ç³»æ•°é‡</div>
                                    </div>
                                    <div class="kg-stat-item">
                                        <div class="kg-stat-value" id="entity-types-count">0</div>
                                        <div class="kg-stat-label">å®ä½“ç±»å‹æ•°</div>
                                    </div>
                                </div>
                                <div class="kg-created-time" id="kg-created-time"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- çŸ¥è¯†å›¾è°±å¯è§†åŒ–å¡ç‰‡ -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3>çŸ¥è¯†å›¾è°±å¯è§†åŒ–</h3>
                            <div>
                                <button id="toggle-edit-mode" class="btn btn-outline-primary" title="åˆ‡æ¢ç¼–è¾‘æ¨¡å¼">
                                    <i class="fas fa-edit"></i> ç¼–è¾‘æ¨¡å¼
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="kg-visualization">
                                <!-- ç¼–è¾‘æ¨¡å¼æ§åˆ¶ -->
                                <div class="edit-mode-controls" id="edit-mode-controls" style="display:none;">
                                    <div class="edit-mode-toggle">
                                        <span class="badge badge-primary">ç¼–è¾‘æ¨¡å¼</span>
                                        <button class="btn btn-sm btn-outline-danger ml-2" id="exit-edit-mode">é€€å‡º</button>
                                    </div>
                                    <div class="edit-mode-actions">
                                        <button class="edit-mode-btn" id="add-node-btn">
                                            <i class="fas fa-plus-circle edit-mode-icon"></i> æ·»åŠ èŠ‚ç‚¹
                                        </button>
                                        <button class="edit-mode-btn" id="add-relation-btn">
                                            <i class="fas fa-arrows-alt-h edit-mode-icon"></i> æ·»åŠ å…³ç³»
                                        </button>
                                        <button class="edit-mode-btn" id="delete-entity-btn">
                                            <i class="fas fa-trash edit-mode-icon"></i> åˆ é™¤é€‰ä¸­å…ƒç´ 
                                        </button>
                                    </div>
                                    
                                    <!-- æ·»åŠ èŠ‚ç‚¹è¡¨å• -->
                                    <form id="add-node-form" class="entity-form">
                                        <div class="entity-form-title">æ·»åŠ æ–°èŠ‚ç‚¹</div>
                                        <div class="entity-form-group">
                                            <label class="entity-form-label">èŠ‚ç‚¹åç§°</label>
                                            <input type="text" class="entity-form-input" name="nodeName" required>
                                        </div>
                                        <div class="entity-form-group">
                                            <label class="entity-form-label">èŠ‚ç‚¹ç±»å‹</label>
                                            <input type="text" class="entity-form-input" name="nodeType" value="Entity">
                                        </div>
                                        <div class="entity-form-group">
                                            <label class="entity-form-label">å±æ€§ (JSONæ ¼å¼)</label>
                                            <textarea class="entity-form-input" name="nodeProperties" rows="3" placeholder='{"key1":"value1","key2":"value2"}'></textarea>
                                        </div>
                                        <div class="entity-form-actions">
                                            <button type="button" class="btn btn-sm btn-secondary" id="cancel-add-node">å–æ¶ˆ</button>
                                            <button type="submit" class="btn btn-sm btn-primary">æ·»åŠ </button>
                                        </div>
                                    </form>
                                    
                                    <!-- æ·»åŠ å…³ç³»è¡¨å• -->
                                    <form id="add-relation-form" class="entity-form">
                                        <div class="entity-form-title">æ·»åŠ æ–°å…³ç³»</div>
                                        <div class="entity-form-group">
                                            <label class="entity-form-label">æºèŠ‚ç‚¹ID</label>
                                            <input type="text" class="entity-form-input" name="sourceNodeId" required>
                                        </div>
                                        <div class="entity-form-group">
                                            <label class="entity-form-label">ç›®æ ‡èŠ‚ç‚¹ID</label>
                                            <input type="text" class="entity-form-input" name="targetNodeId" required>
                                        </div>
                                        <div class="entity-form-group">
                                            <label class="entity-form-label">å…³ç³»ç±»å‹</label>
                                            <input type="text" class="entity-form-input" name="relationType" required>
                                        </div>
                                        <div class="entity-form-group">
                                            <label class="entity-form-label">å±æ€§ (JSONæ ¼å¼)</label>
                                            <textarea class="entity-form-input" name="relationProperties" rows="3" placeholder='{"key1":"value1","key2":"value2"}'></textarea>
                                        </div>
                                        <div class="entity-form-actions">
                                            <button type="button" class="btn btn-sm btn-secondary" id="cancel-add-relation">å–æ¶ˆ</button>
                                            <button type="submit" class="btn btn-sm btn-primary">æ·»åŠ </button>
                                        </div>
                                    </form>
                                </div>
                                
                                <div id="neo4j-graph"></div>
                                <div id="kg-loading" class="kg-loading">
                                    <div class="kg-spinner"></div>
                                    <div id="loading-message">åŠ è½½ä¸­...</div>
                                </div>
                                <!-- æ§åˆ¶æŒ‰é’®ç»„ -->
                                <div class="kg-controls">
                                    <button id="zoom-in-btn" title="æ”¾å¤§">+</button>
                                    <button id="zoom-out-btn" title="ç¼©å°">-</button>
                                    <button id="zoom-fit-btn" title="é€‚åº”è§†å›¾">âŸ²</button>
                                    <button id="fullscreen-btn" title="å…¨å±æŸ¥çœ‹">â¤¢</button>
                                    <button id="physics-btn" title="ç‰©ç†å¸ƒå±€" class="active">ğŸ§²</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- çŸ¥è¯†å›¾è°±æŸ¥è¯¢å¡ç‰‡ -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3>çŸ¥è¯†å›¾è°±æŸ¥è¯¢</h3>
                        </div>
                        <div class="card-body">
                            <div class="kg-query-section">
                                <form id="query-form" class="query-form">
                                    <div class="form-group">
                                        <label for="query-input">è¾“å…¥æ‚¨çš„æŸ¥è¯¢é—®é¢˜:</label>
                                    </div>
                                    <div class="query-input-wrapper">
                                        <textarea id="query-input" class="form-control" placeholder="ä¾‹å¦‚ï¼šç¦»åˆå™¨çš„æè´¨æœ‰å“ªäº›ï¼Ÿ" rows="3"></textarea>
                                        <button type="submit" id="query-button" class="query-button-inline">æŸ¥è¯¢</button>
                                    </div>
                                    <button type="button" id="clear-button" class="btn btn-secondary query-clear-button">æ¸…é™¤</button>
                                </form>
                            </div>
                            <div id="query-result"></div>
                        </div>
                    </div>
                </div>
                
                <!-- æ–‡æ¡£ä¸Šä¼ æ ‡ç­¾é¡µ -->
                <div class="tab-pane fade" id="upload" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3>ä¸Šä¼ æ–‡æ¡£åˆ›å»ºçŸ¥è¯†å›¾è°±</h3>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-4">
                                ä¸Šä¼ æ–‡æ¡£è‡ªåŠ¨æå–å®ä½“å’Œå…³ç³»ï¼Œåˆ›å»ºæ‚¨çš„ä¸“å±çŸ¥è¯†å›¾è°±ã€‚ç›®å‰æ”¯æŒTXTæ–‡æœ¬æ–‡ä»¶æ ¼å¼ã€‚
                            </p>
                            <div class="upload-area" id="upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="upload-text">
                                    æ‹–æ‹½æ–‡ä»¶è‡³æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶
                                </div>
                                <input type="file" id="file-input" class="file-input" accept=".txt,.pdf,.doc,.docx">
                                <label for="file-input" class="file-label">é€‰æ‹©æ–‡ä»¶</label>
                                <div class="upload-progress mt-3" id="upload-progress">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <small class="text-muted mt-1 d-block text-center">ä¸Šä¼ è¿›åº¦</small>
                                </div>
                            </div>
                            
                            <div class="upload-file-list" id="upload-file-list">
                                <!-- ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ä¼šåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            
                            <div class="processing-status mt-4" id="processing-status" style="display:none;">
                                <h5>æ–‡æ¡£å¤„ç†ä¸­</h5>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                                </div>
                                <p class="text-muted mt-2">æ­£åœ¨ä»æ–‡æ¡£æå–çŸ¥è¯†ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´...</p>
                            </div>
                            
                            <div class="creation-result mt-4" id="creation-result" style="display:none;">
                                <!-- åˆ›å»ºç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å›¾è°±ç®¡ç†æ ‡ç­¾é¡µ -->
                <div class="tab-pane fade" id="manage" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3>ä¸´æ—¶çŸ¥è¯†å›¾è°±ç®¡ç†</h3>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <button class="btn btn-outline-primary" id="refresh-kg-list">
                                    <i class="fas fa-sync"></i> åˆ·æ–°åˆ—è¡¨
                                </button>
                            </div>
                            <div id="temp-kg-list" class="kg-list">
                                <!-- ä¸´æ—¶çŸ¥è¯†å›¾è°±åˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
                                <div class="alert alert-info" id="no-temp-kg-msg">
                                    æš‚æ— ä¸´æ—¶çŸ¥è¯†å›¾è°±
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ç¡®è®¤åˆ é™¤çš„æ¨¡æ€æ¡† -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ç¡®è®¤åˆ é™¤</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçŸ¥è¯†å›¾è°±å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">åˆ é™¤</button>
            </div>
        </div>
    </div>
</div>

<!-- èŠ‚ç‚¹è¯¦æƒ…æ¨¡æ€æ¡† -->
<div class="modal fade" id="nodeDetailModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">èŠ‚ç‚¹è¯¦æƒ…</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>èŠ‚ç‚¹ID:</label>
                            <input type="text" class="form-control" id="node-detail-id" readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>èŠ‚ç‚¹ç±»å‹:</label>
                            <input type="text" class="form-control" id="node-detail-labels" readonly>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>èŠ‚ç‚¹åç§°:</label>
                    <input type="text" class="form-control" id="node-detail-name">
                </div>
                <div class="form-group">
                    <label>å±æ€§:</label>
                    <div id="node-detail-properties">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>å±æ€§</th>
                                    <th>å€¼</th>
                                </tr>
                            </thead>
                            <tbody id="node-properties-table">
                                <!-- å±æ€§å°†åŠ¨æ€åŠ è½½ -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="node-relations" class="mt-4">
                    <h6>å…³è”å…³ç³»:</h6>
                    <ul class="list-group" id="node-relations-list">
                        <!-- å…³ç³»å°†åŠ¨æ€åŠ è½½ -->
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">å…³é—­</button>
                <button type="button" class="btn btn-primary" id="save-node-changes" style="display:none;">ä¿å­˜ä¿®æ”¹</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
